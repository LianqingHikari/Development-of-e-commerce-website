<div align = "center" style="font-size:25px;font-weight: bold">华南理工大学</div>

<div align = "center" style="font-size:25px;font-weight: bold">《网络应用开发》课程实验报告</div>

实验题目：设计并实现一个电子商务网站的开发和在线部署

姓名：陈明奕

学号：201930640018

班级：19计科2班

指导老师：布社辉

---

[TOC]

# 实验概述

### 1.1 实验题目

设计并实现一个电子商务网站的开发和在线部署

### 1.2 基本功能要求

顾客：

- 用户的注册、登录、注销
- 购买流程（浏览/查询->添加至购物篮->付款->发送电子邮件确认收货）

销售：

- 商品目录的管理（包括最基本的增删改等操作）
- 后台销售统计报表，销售状态
- 客户的浏览/购买日志记录

### 1.3 实验环境和工具

操作系统：Windows10

Web服务器：Tomcat7.0

java开发包：JDK1.7

数据库：MySQL5.6

开发工具：IDEa

浏览器：Microsoft Edge版本 96.0.1054.43 (64 位)

# 实验内容

### 2.1 系统设计

#### 2.1.1 数据库设计

##### 2.1.1.1 Users表

| 属性名称     | 属性类型     | 是否可为空 | 是否为主键 |
| ------------ | ------------ | ---------- | ---------- |
| UserAccount  | varchar(100) | 否         | 是         |
| UserPassword | varchar(100) | 否         | 否         |
| UserEmail    | varchar(100) | 否         | 否         |

用于存储用户的信息



##### 2.1.1.2 Products表

| 属性名称           | 属性类型     | 是否可为空 | 是否为主键 |
| ------------------ | ------------ | ---------- | ---------- |
| ProductName        | varchar(100) | 否         | 是         |
| ProductPrice       | double       | 否         | 否         |
| ProductDescription | varchar(200) | 否         | 否         |
| ProductType        | varchar(100) | 否         | 否         |
| ProductPictureName | varchar(200) | 否         | 否         |
| ProductSale        | int(11)      | 否         | 否         |

用户存储商品的信息



##### 2.1.1.3 Carts表

| 属性名称      | 属性类型     | 是否可为空 | 是否为主键 |
| ------------- | ------------ | ---------- | ---------- |
| UserAccount   | varchar(100) | 否         | 否         |
| ProductName   | varchar(100) | 否         | 否         |
| ProductPrice  | double       | 否         | 否         |
| ProductNumber | int(11)      | 否         | 否         |

用于存储用户购买的商品信息



##### 2.1.1.4 BuyLogs表

| 属性名称      | 属性类型     | 是否可为空 | 是否为主键 |
| ------------- | ------------ | ---------- | ---------- |
| UserAccount   | varchar(100) | 否         | 否         |
| ProductName   | varchar(100) | 否         | 否         |
| ProductNumber | int(11)      | 否         | 否         |
| BrowseTime    | varchar(100) | 否         | 否         |

用于存储用户的购买记录



##### 2.1.1.5 BrowseLogs表

| 属性名称    | 属性类型     | 是否可为空 | 是否为主键 |
| ----------- | ------------ | ---------- | ---------- |
| UserAccount | varchar(100) | 否         | 否         |
| ProductName | varchar(100) | 否         | 否         |
| BrowseTime  | varchar(100) | 否         | 否         |

用于存储用户的浏览记录



#### 2.1.2 网站文件架构

网站文件的基本架构图如下：

<img src="E:\Typora\images\连清电商网架构.png" width=60%>

其中：

##### 2.1.2.1 out：文件存放源代码编译之后的结果

##### 2.1.2.2 src：存放java源代码

- dao：生成SQL语句，负责与数据库进行交互
- domain：存放需要用到的java类
- filter：过滤器
- service：servlet与dao之间的中间层，负责将来自servlet的请求传递给dao
- servlet：存放servlet文件，负责处理网页请求并转交给service
- utils：一些工具类

##### 2.1.2.3 Web：网页的根目录，存放jsp文件和图片

###### 2.1.2.3.1 client

- .jsp文件：实现基本的网站页面
- images：存放网站页面需要用到的图片

###### 2.1.2.3.2 WEB-INF

- lib：存放需要用到的库
- web.xml：关联文件，需要调用某个servlet时，可以通过该文件查到关联字段



#### 2.1.3 网站网页架构

网站网页架基本架构图如下：

<img src="E:\Typora\images\网站页面架构-16386928930902.png" width=60%>

#### 2.1.4 基本功能实现

基本流程：（基本流程大同小异，细节上有所差别）

1. 网页向Servlet发出请求
2. Servlet接收请求并转发给Service
3. Service接收请求并转发给dao
4. dao生成相应SQL语句与数据库进行交互并返回结果
5. 网页显示相关结果



登录：通过会话设置用户账号和用户密码信息，并根据用户名的不同跳转到索引界面或者管理员界面

##### 2.1.4.1 索引界面

###### 2.1.4.1.1 商品界面

- 浏览商品：在Products表格中查询所有商品并在jsp页面中以table的形式呈现；对于搜索所得商品，通过搜索时的关键字ProductName在数据库中进行查询并返回查询结果在jsp中以table的形式呈现。
- 加入购物车：将商品信息与用户信息加入到Carts表格中。

###### 2.1.4.1.2 购物车界面

- 商品结算：通过用户账号查询Carts表格中所有该用户的订单并计算总价，点击“结算”按钮后将清除Carts表格中所有该用户的订单并通过SendEmailUtils中SendEmail方法向用户的邮箱发送发货邮件。商品结算后将数据库中对应商品的销量进行增加。
- 删除商品：通过删除时输入的关键字“ProductName”在Carts表格中查询该用户对应该商品的订单并进行删除，然后刷新页面。

###### 2.1.4.1.3 个人中心界面

- 登出：直接跳转到登录界面。

##### 2.1.4.2 管理员界面

###### 2.1.4.2.1 商品管理

- 添加商品：生成一个Product类的对象，并通过网页中所给信息对该对象的属性进行赋值，最后将该对象传到dao层并将数据输入数据库
- 更改商品信息：与添加商品基本一致，但是SQL语句为UPDATE
- 删除商品：在数据库中删除具有相应商品名称的商品

###### 2.1.4.2.2 商品情况

- 显示所有商品：查询Products中的所有商品并返回查询结果在jsp中以table的形式呈现。
- 统计销售情况：查询Products中的所有商品的名称ProductName以及销量ProductSale并返回查询结果在jsp中以table的形式呈现。

###### 2.1.4.2.3 用户日志

- 查询用户购买/浏览记录：通过用户名查询BrowseLogs表和Buylogs表中的所有信息并返回，在jsp中以table的形式呈现。

##### 2.1.4.3 注册界面

- 用户注册：将用户提交的信息插入到Users表中，如何用户名重复，则提示错误。

### 2.2 代码实现

#### 2.2.1 代码实现的基本流程

以商品搜索为例子讲解代码实现的基本流程。

##### 2.2.1.1 网页向Servlet发出请求

在jsp页面中，通过表单form对参数进行收集，并通过submit方法以get或post方法提交到action所对应的Servlet中，如下为商品搜索的jsp部分代码：

<img src="E:\Typora\images\image-20211206162452772.png" width=90%>

在表单中收集ProductName信息并以post方法提交到MenuSearch中进行处理。如果搜索结果出错，将通过Session中的search_message对象显示错误信息。

##### 2.2.1.2 Servlet接收请求并转发给Service

Servlet通过dopost和doget方法对于jsp页面发出了request进行处理。一般而言有如下步骤：

1. 创建Service对象
2. 设置相关参数
3. 调用Service的方法
4. 对返回结果进行处理

下面是Servlet的部分代码：

<div align="center">
    <img src="E:\Typora\images\image-20211206163008960.png" width=90%>
</div>

首先创建ProductService对象，然后调用Service的方法通过ProductName寻找商品。若找到了，返回结果并转交给AddBrowseLog进行日志增加操作；若没有找到，跳转到索引页面并返回错误信息。

##### 2.2.1.3 Service接收请求并转发给dao

Service接受到请求后，将创建一个dao的对象，并调用dao的方法使之与数据库进行交互。下面是Service的部分代码：

<img src="E:\Typora\images\image-20211206163516622.png" width=70%>

通过dao调用方法即可。

##### 2.2.1.4 dao生成相应SQL语句与数据库进行交互并返回结果

dao首先对数据库进行连接，然后根据Service提供的参数生成SQL语句，通过execute操作执行SQL语句与数据库进行交互，最后对返回的结果进行处理并断开连接。下面是dao的部分代码：

<img src="E:\Typora\images\image-20211206163759745.png" width=65%>

手下通过getDateSource和getConnection方法与数据库取得连接，然后通过传入的ProductName参数设置SQL语句并通过executeQuery方法进行执行，最后将返回的结果赋值给一个product对象并返回product对象。

##### 2.2.1.5 网页显示相关结果

最后相关的jsp页面将对结果进行展示，对于包含较多信息的返回结果，一般采用foreach进行逐一展示。下面是SearchResult的部分代码：

<img src="E:\Typora\images\image-20211206164218563.png" width=80%>

在table中，通过Session对象直接展示相关搜索结果。

#### 2.2.2 代码功能说明

下面对本项目中所用到的源代码的功能进行简单的说明。

##### 2.2.2.1 src

###### 2.2.2.1.1 dao

- CartDao 购物车相关的Dao
- LogDao 日志相关的Dao
- ProductDao 商品相关的Dao
- UserDao 用户相关的Dao

###### 2.2.2.1.2 domain

- BrowseLog 浏览日志类
- BuyLog 购买日志类
- Cart 购物车类
- Product 商品类
- User 用户类

###### 2.2.2.1.3 filter

- EncodingFilter 过滤器，主要用于解决乱码问题

###### 2.2.2.1.4 service

- CartService 与购物车相关的服务，提供“获取所有订单”、“添加订单”、“删除订单”、“结算”功能。
- LogService 与日志相关的服务，提供“添加日志”、“搜索日志”的功能。
- ProductService 与商品相关的服务，提供“查找商品”、“添加商品”、“删除商品”、“更新商品”、“展示所有商品”的功能。
- UserService 与用户相关的服务，提供“注册”和“登录”的功能。

###### 2.2.2.1.5 servlet

- AddBrowseLog 添加浏览日志
- AddCart 添加购物车信息
- AddProduct 添加商品
- DeleteCart 删除订单
- DeleteProduct 删除商品
- FindCart 搜索订单
- Login 登录
- Logout 登出
- MenuSearch 搜索商品
- PayCart 结算
- Register 登录
- Return 返回
- SearchAllProduct 搜索所有商品
- SendEmail 发送邮件
- ShowAllLog 展示所有日志
- ShowAllProduct 展示所有商品
- ShowSale 展示所有商品销量
- UpdateProduct 更新商品信息

###### 2.2.2.1.5 utils

- DateSourceUtils 提供与数据库连接相关方法的工具类
- SendEmailUtils 提供发送邮件相关方法的工具类

##### 2.2.2.2 web

###### 2.2.2.2.1 client

- AddProduct 添加商品页面
- AdminCenter 管理员中心页面
- Cart 购物车页面
- DeleteCart 删除订单页面
- DeleteProduct 删除商品页面
- index 索引页面
- login 登录页面
- OperateSuccess 操作成功提示页面
- register 注册页面
- SearchResult 搜索结果页面
- ShowAllLog 展示所有日志页面
- ShowAllProduct 展示所有商品页面
- ShowSale 展示商品销售记录页面
- UpdateProduct 更新商品页面
- UserCenter 用户中心页面

#### 2.2.3 代码开源

##### 2.2.3.1 在github上注册一个账号

![image-20211210181204889](E:\Typora\images\image-20211210181204889.png)

##### 2.2.3.2 上传代码

![image-20211210181224107](E:\Typora\images\image-20211210181224107.png)

一下为github网址：[LianqingHikari/Development-of-e-commerce-website (github.com)](https://github.com/LianqingHikari/Development-of-e-commerce-website)

### 2.3 功能测试

#### 2.3.1 登录与注册

##### 2.3.1.1 注册账号

<img src="E:\Typora\images\image-20211206180739785.png" width=35%>

设置好账号、密码、电子邮箱点击注册即可注册成功并跳转到索引界面。如果账号已经存在，将提示错误信息：

<img src="E:\Typora\images\image-20211206181029286.png" width=30%>

在数据库中可以看到，该用户的信息已经成功插入：

<img src="E:\Typora\images\image-20211206181122544.png" width=50%>

##### 2.3.1.2 登录账号

输入刚刚注册的账号及其密码，即可成功登录：

<img src="E:\Typora\images\image-20211206181225829.png">

#### 2.3.2 浏览与搜索

在索引界面，用户可以看到当前商城中的所有商品：

<img src="E:\Typora\images\image-20211206181347867.png" width=60%>

点击商品名称或者通过商品名称进行搜索即可查看详细的商品信息：

<img src="E:\Typora\images\image-20211206181531464.png" width=60%>

<img src="E:\Typora\images\image-20211206181618454.png" width=50%>

用户查看商品之后，可以看到数据库中存入了用户的浏览信息：

<img src="E:\Typora\images\image-20211206181854849.png" width=70%>

#### 2.3.3 选购与结算

用户在浏览商品的时候，输入需要购买的商品数量并选择加入购物车即可将商品加入购物车：

<img src="E:\Typora\images\image-20211206182017792.png" width=50%>

在数据库中，可以看到已经加入购物车的商品信息：

<img src="E:\Typora\images\image-20211206182236171.png" width=70%>

查看购物车，可以看到已经选中的商品

<img src="E:\Typora\images\image-20211206182155885.png" width=15%>

![image-20211206182305488](E:\Typora\images\image-20211206182305488.png)

点击删除，可以将对应的商品删除

![image-20211206182420751](E:\Typora\images\image-20211206182420751.png)

点击结算，购物车中的所有商品将被删除，同时物品销量增加，用户也将受到发货邮件：
![image-20211206182523285](E:\Typora\images\image-20211206182523285.png)

<img src="E:\Typora\images\image-20211206182528012.png" width=40%>

#### 2.3.4 商品管理

登录管理员账号，可以进入管理员中心：

<img src="E:\Typora\images\image-20211206182859975.png" width=35%>

##### 2.3.4.1 可以进行增加商品、删除商品和修改商品信息的操作：

添加商品：

<img src="E:\Typora\images\image-20211206183219620.png" width=50%>

删除商品：

<img src="E:\Typora\images\image-20211206183241357.png" width=30%>

修改商品信息：

<img src="E:\Typora\images\image-20211206183326790.png" width=50%>

##### 2.3.4.2 可以查看商品的情况：

销售统计：

<img src="E:\Typora\images\image-20211206183415800.png" width=50%>

所有商品：

<img src="E:\Typora\images\image-20211206183441607.png">

##### 2.3.4.3 也可以查看用户日志：

![image-20211206184104472](E:\Typora\images\image-20211206184104472.png)

### 2.4 应用部署

#### 2.4.1 文件准备

##### 2.4.1.1 导出war文件

添加Artifact项

<img src="E:\Typora\images\image-20211210154213383.png" width=60%>

导出Artifact得到.war文件

<img src="E:\Typora\images\image-20211210154257515.png" width=40%>

##### 2.4.1.2 导出sql文件

通过mysqldump在IDEa中将数据库导出为sql文件

<img src="E:\Typora\images\image-20211210154049112.png" width=50%>

#### 2.4.2 阿里云账号注册与云服务器申请

##### 2.4.2.1 登录阿里云

<img src="E:\Typora\images\image-20211210154453124.png" width=50%>

##### 2.4.2.2 购买ECS云服务器

<img src="E:\Typora\images\image-20211210154551750.png" width=80%>

##### 2.4.2.3 配置操作系统

选择宝塔控制版面

<img src="E:\Typora\images\image-20211210165826960.png" width=50%>

#### 2.4.3 服务器环境的搭建

##### 2.4.3.1 远程连接

通过控制台远程连接到服务器

<img src="E:\Typora\images\image-20211210165603905.png" width=50%>

输入指令，得到外网地址与账号和密码

<img src="E:\Typora\images\image-20211210165431746.png" width=50%>

登录到服务器端

<img src="E:\Typora\images\image-20211210165923384.png" width=90%>

##### 2.4.3.2 软件下载

下载7.0版本的tomcat与5.5版本的MySQL，保持与原环境一致。

![image-20211210170022926](E:\Typora\images\image-20211210170022926.png)

![image-20211210170036314](E:\Typora\images\image-20211210170036314.png)

##### 2.4.3.3 配置MySQL

添加数据库，注意设置访问权限为所有人

<img src="E:\Typora\images\image-20211210170155143.png" width=50%>

导入生成好的sql文件

<img src="E:\Typora\images\image-20211210170244043.png" width=50%>

##### 2.4.3.4 配置Tomcat

在Tomcat的webapps文件中导入war文件

<img src="E:\Typora\images\image-20211210170508915.png" width=60%>

修改端口号

<img src="E:\Typora\images\image-20211210170605112.png" width=50%>



##### 2.4.3.5 修改安全设置

在控制面板中将数据库的端口以及Tomcat的端口放行

![image-20211210173157040](E:\Typora\images\image-20211210173157040.png)

![image-20211210173205537](E:\Typora\images\image-20211210173205537.png)

在阿里云的安全组配置人，入方向和出方向都要授权给所有对象

<img src="E:\Typora\images\image-20211210173313072.png" width=60%>

#### 2.4.4 一些遇到的其他问题

##### 2.4.4.1 MySQL的大小写区分

Linux版本下的MySQL区分大小写，导致在windows上可运行的SQL语句无效。将SQL语句中表格的名称全部改为对应格式即可。

##### 2.4.4.2 数据库连接缓慢

数据库的访问非常的缓慢。在MySQL的性能调节中选中优化方案为1-2GB，即可设置默认的相关参数。数据库访问速度有明显提升。

<img src="E:\Typora\images\image-20211210175307590.png" width=50%>

##### 2.4.4.3 数据库连接问题

得到服务器端数据库的账号和密码后，要重新配置数据库连接的xml文件。端口也要改为3306

![image-20211210175627852](E:\Typora\images\image-20211210175627852.png)



以上全部设置完成后即可正常访问网站。

缺点：由于访问速度太慢，发送邮件功能无法使用，购物车结算功能受影响。

# 小结

通过完成一个网站从搭建到部署的全过程，我进一步加深了对于软件开发的认识。对于以前从没有接触过网络编程的我来说，这个任务可以说是非常的有挑战性。从基础知识到软件的使用，大量的知识需要我去学习，而DDL则迫在眉睫，我也无法知道我能不能如期完成任务。得益于同学们的互相帮助和老师的指导，我最终还是如期完成了任务。

# 指导教师评语及成绩

评语：

成绩：

指导教师签名：

批阅日期：